<h1>Historias</h1>

<p-button label="Nueva Historia" icon="pi pi-plus" class="mr-2" (onClick)="abrirDialogo()" />

<p-table [value]="historias" [tableStyle]="{'min-width': '50rem'}">
  <ng-template pTemplate="header">
    <tr>
      <th style="width:10%">ID</th>
      <th style="width:20%">NOMBRE</th>
      <th style="width:30%">DESCRIPCIÓN</th>
      <th style="width:20%">IMAGEN</th>
      <th style="width:10%">ADMINISTRADOR</th>
      <th style="width:10%">OPCIONES</th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-historia>
    <tr>
      <td>{{ historia.id }}</td>
      <td>{{ historia.nombreHistoria }}</td>
      <td>{{ historia.descripcion }}</td>
      <td>
        <img *ngIf="historia.imagen" [src]="historia.imagen" class="historia-imagen" alt="Imagen de {{ historia.nombreHistoria }}" width="100" />
      </td>
      <td>{{ historia.administrador?.nombre_usuario }}</td>
      <td>
        <div class="flex items-center justify-center gap-2">
          <button
            pButton
            pRipple
            type="button"
            icon="pi pi-pencil"
            (click)="editarHistoria(historia)"
            text
            rounded
            severity="secondary"
            title="Editar historia"
          ></button>
          <button
            pButton
            pRipple
            type="button"
            icon="pi pi-times"
            (click)="eliminarHistoria(historia)"
            text
            rounded
            severity="secondary"
            title="Eliminar historia"
          ></button>
        </div>
      </td>
    </tr>
  </ng-template>
</p-table>

<!-- CREATE y UPDATE -> Formulario -->
<p-dialog header="Creación/Edición de Historias" [modal]="true" [(visible)]="visible" [style]="{ width: '30rem' }">
  <div class="flex items-center gap-4 mb-4">
    <label for="nombre" class="font-semibold w-32">Nombre</label>
    <input pInputText id="nombre" class="flex-auto" autocomplete="off" [(ngModel)]="historiaDialogo.nombreHistoria" />
  </div>

  <div class="flex items-center gap-4 mb-4">
    <label for="descripcion" class="font-semibold w-32">Descripción</label>
    <input pInputText id="descripcion" class="flex-auto" autocomplete="off" [(ngModel)]="historiaDialogo.descripcion" />
  </div>

  <div class="flex items-center gap-4 mb-4">
    <label for="imagen" class="font-semibold w-32">Imagen</label>
    <p-fileupload
      mode="basic"
      name="demo[]"
      chooseIcon="pi pi-upload"
      accept="image/*"
      (onSelect)="onBasicUploadAuto($event)"
      chooseLabel="Elegir Imagen"
    />
  </div>

  <div class="flex items-center gap-4 mb-4">
    <label for="administrador" class="font-semibold w-32">Administrador</label>
    <p-dropdown
      id="administrador"
      [options]="administradores"
      [(ngModel)]="administradorSeleccionado"
      optionLabel="nombre_usuario"
      placeholder="Seleccione un administrador"
      class="w-full md:w-56"
    />
  </div>

  <div class="flex justify-end gap-2">
    <p-button label="Cancelar" severity="secondary" (click)="visible = false" />
    <p-button label="Guardar" (click)="guardarHistoria()" />
  </div>
</p-dialog>
